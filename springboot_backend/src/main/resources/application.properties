# ============================================
# Spring Boot Application Configuration
# ============================================
# 使用环境变量进行配置，参考 template.env 文件

# 应用名称
spring.application.name=${SPRING_APPLICATION_NAME:springboot_backend}

# 服务器配置
server.port=${SERVER_PORT:8080}
# 服务前置URL（应用上下文路径），所有接口都会加上此前缀
# 例如：设置为 /api 后，访问路径变为 http://localhost:8080/api/api/v1/login
server.servlet.context-path=${SERVER_CONTEXT_PATH:}

# API基础路径配置（用于Controller中的@RequestMapping）
# 注意：此配置需要配合代码使用，当前Controller中硬编码了 /api/v1
# 如需动态配置，需要修改Controller使用此配置值
API_BASE_PATH=${API_BASE_PATH:/api/v1}

# ============================================
# 数据库配置
# ============================================
# 数据源配置
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:h2:mem:talk2me}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:sa}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=${SPRING_DATASOURCE_DRIVER_CLASS_NAME:org.h2.Driver}

# JPA/Hibernate配置
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=${SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL:true}
# 禁用Open Session In View（RESTful API不需要在视图渲染期间保持数据库连接）
spring.jpa.open-in-view=false

# H2控制台配置
spring.h2.console.enabled=${SPRING_H2_CONSOLE_ENABLED:false}
spring.h2.console.path=${SPRING_H2_CONSOLE_PATH:/h2-console}
spring.h2.console.settings.web-allow-others=${SPRING_H2_CONSOLE_WEB_ALLOW_OTHERS:false}
spring.h2.console.settings.trace=false

# ============================================
# Redis配置（Session存储）
# ============================================
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.database=${SPRING_DATA_REDIS_DATABASE:0}
spring.data.redis.timeout=${SPRING_DATA_REDIS_TIMEOUT:2000ms}
spring.data.redis.lettuce.pool.max-active=${SPRING_DATA_REDIS_LETTUCE_POOL_MAX_ACTIVE:8}
spring.data.redis.lettuce.pool.max-wait=${SPRING_DATA_REDIS_LETTUCE_POOL_MAX_WAIT:-1ms}
spring.data.redis.lettuce.pool.max-idle=${SPRING_DATA_REDIS_LETTUCE_POOL_MAX_IDLE:8}
spring.data.redis.lettuce.pool.min-idle=${SPRING_DATA_REDIS_LETTUCE_POOL_MIN_IDLE:0}

# Session配置
# 注意：应用使用无状态JWT认证（SessionCreationPolicy.STATELESS），不需要Spring Session
# 如果需要使用Spring Session，请取消注释pom.xml中的spring-boot-starter-session-data-redis依赖
# spring.session.store-type=${SPRING_SESSION_STORE_TYPE:none}
# server.servlet.session.timeout=${SPRING_SESSION_TIMEOUT:1800}

# ============================================
# 文件上传配置
# ============================================
spring.servlet.multipart.max-file-size=${SPRING_SERVLET_MULTIPART_MAX_FILE_SIZE:10MB}
spring.servlet.multipart.max-request-size=${SPRING_SERVLET_MULTIPART_MAX_REQUEST_SIZE:50MB}

# ============================================
# 日志配置
# ============================================
logging.level.root=${LOGGING_LEVEL_ROOT:INFO}
logging.level.com.example.springboot_backend=${LOGGING_LEVEL_COM_EXAMPLE_SPRINGBOOT_BACKEND:DEBUG}
# 降低Tomcat APR native库加载失败的警告级别（这是可选的性能优化，不影响功能）
logging.level.org.apache.catalina.core.AprLifecycleListener=${LOGGING_LEVEL_APR:WARN}
# 降低HandlerMappingIntrospector缓存未命中的警告级别（首次请求时的正常行为）
logging.level.org.springframework.web.servlet.handler.HandlerMappingIntrospector=${LOGGING_LEVEL_HANDLER_MAPPING:INFO}
logging.file.path=${LOGGING_FILE_PATH:logs}
logging.file.name=${LOGGING_FILE_NAME:logs/springboot_backend.log}
logging.logback.rollingpolicy.max-file-size=${LOGGING_FILE_MAX_SIZE:10MB}
logging.logback.rollingpolicy.max-history=${LOGGING_FILE_MAX_HISTORY:30}

# ============================================
# Spring Boot Actuator配置
# ============================================
# Actuator端点基础路径
management.endpoints.web.base-path=${MANAGEMENT_ENDPOINTS_WEB_BASE_PATH:/actuator}
# 暴露的端点（开发环境可以暴露更多，生产环境应该限制）
management.endpoints.web.exposure.include=${MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE:health,info}
# 启用健康检查端点详细信息（仅开发环境）
management.endpoint.health.show-details=${MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS:never}
# Actuator端点端口（默认与server.port相同）
# management.server.port=${MANAGEMENT_SERVER_PORT:}

# ============================================
# CORS跨域配置
# ============================================
# 注意：CORS配置通过CorsConfig类读取环境变量
# 允许的源（多个用逗号分隔）
# CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
# 允许的HTTP方法
# CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
# 允许的请求头
# CORS_ALLOWED_HEADERS=*
# 是否允许携带凭证
# CORS_ALLOW_CREDENTIALS=true
# 预检请求缓存时间（秒）
# CORS_MAX_AGE=3600

# ============================================
# 应用环境配置
# ============================================
spring.profiles.active=${SPRING_PROFILES_ACTIVE:dev}
